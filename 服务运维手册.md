服务运维手册（frontend-miker｜dev/staging/prod）

一、概览
- 架构：Next.js（端口 3000）→ Service NodePort:80→3000 → Ingress（ALB，target-type=instance）。
- 环境与域名：
  - dev：`miker-dev.chekkk.com`
  - staging：`miker-staging.chekkk.com`
  - prod：`miker.chekkk.com`（80=301→443，业务只在 443）

二、日常发布（PR 合并自动发布）
1) 合并到 dev/staging/main → Actions 触发 `ci`：构建并推 VECR（tags：`sha-<short>`，dev/staging 追加 `*-latest`）。
2) `deploy` 通过 `workflow_run`（ci 成功后）自动部署目标环境：
   - 等待镜像可用（manifest inspect 重试）
   - 命名空间自动创建（`miker-<env>`）
   - 应用 Service/Deployment/Ingress（NodePort/instance 模式，端口 3000）
3) 验证：
   - `kubectl -n miker-<env> rollout status deploy/frontend-miker`
   - `curl -I http(s)://<域名>/`（dev 可能 307，staging/prod 200）

三、回滚
1) 找到上一个稳定镜像：Actions → `ci` 运行 → 复制 `sha-<short>`。
2) 临时回滚（kubectl）：
   ```bash
   kubectl -n miker-<env> set image deploy/frontend-miker app=chek-images-cn-beijing.cr.volces.com/prod/frontend-miker:sha-<short>
   kubectl -n miker-<env> rollout status deploy/frontend-miker
   ```
3) 持久化：将该 sha 提交到部署清单/工作流参数（或通过 CI 重新发布）保持一致性。

四、故障排查（快捷清单）
- 503/超时
  - `kubectl -n miker-<env> get po,svc,ing` → Deployment Ready=1/1？
  - `kubectl -n miker-<env> get endpoints frontend-miker -o wide` → 容器端口=3000？
  - `kubectl -n miker-<env> describe ing frontend-miker` → 注解为 `target-type: instance`/`address-type: internet`；ALB 事件无健康检查错误？
  - 节点安全组：是否放通“ALB 安全组 → NodePort 段（30000–32767/TCP 或实际端口）”
- 容器探针失败
  - `kubectl -n miker-<env> logs deploy/frontend-miker --tail=200`
  - 探针路径/端口对齐 3000，镜像是否对应最新 sha
- 域名异常
  - `nslookup <域名>` → 指向 ALB FQDN（CNAME），非 A 到 EIP
  - `curl -H 'Host: <域名>' http://<ALB-IP>/ -I` → 验证 80/443 路由是否命中预期后端

五、飞书与 YApi（自动链路）
- 飞书拉群+通知（组织级）
  - 条件：业务仓 Secrets 配置 `FEISHU_CHAT_ID_PROD`、`GITOPS_PAT`
  - 业务仓 `notify-dispatch.yml` 在 CI/Deploy 成功后自动 `repository_dispatch` 到组织仓；组织仓入口工作流完成“成员同步入群 + 卡片通知”
  - 验证：组织仓 `.github` → Actions → Org Feishu Sync Members（`sync=success`、`notify=success`；Artifacts 三份诊断文件）
- YApi 同步
  - 建议接入组织级工作流：CI 成功后自动 dispatch 导入 OpenAPI
  - 验证：`https://yapi.chekkk.com/project/<id>/interface/api` 能看到最新接口；Actions 日志包含 “YApi synchronization successful.”

六、镜像仓库（VECR）治理
- 仓库：`chek-images-cn-beijing.cr.volces.com/prod/frontend-miker`
- 保留策略：`dev-latest`、`stg-latest` 与最近 15 个 `sha-*`；更旧 `sha-*` 定期清理（不触碰自定义标签）
- 审计脚本：只读列出与清理计划，默认不删除；需要时逐条删除（保守执行）

七、常用命令（速查）
```bash
# 发布状态
kubectl -n miker-<env> get deploy,po,svc,ingress
kubectl -n miker-<env> rollout status deploy/frontend-miker

# Ingress/ALB 诊断
kubectl -n miker-<env> describe ing frontend-miker | sed -n '1,160p'

# Service/Endpoints
kubectl -n miker-<env> get svc frontend-miker -o wide
kubectl -n miker-<env> get endpoints frontend-miker -o yaml | sed -n '1,80p'

# 覆盖镜像（临时回滚/前推）
kubectl -n miker-<env> set image deploy/frontend-miker app=chek-images-cn-beijing.cr.volces.com/prod/frontend-miker:sha-<short>

# 外部验证
curl -I -L --max-time 10 http://miker-<env>.chekkk.com/
```

八、SLO 与告警（建议）
- 可用性：月度 ≥ 99.9%（业务 200/3xx）；探针/页面失败率阈值告警
- 部署：rollout 超时/失败自动告警；自动回滚开关按业务重要度评估
- 入站：ALB 目标组不健康数、5xx/4xx（维度：Listener/Rule/ServerGroup）

---

服务运维手册（backend-gateway-saas｜Dev/Staging/Prod）

一、概览与职责
- 架构：Spring Cloud Gateway（容器端口 12000）→ Service `backend-gateway-saas:80→12000` → Ingress/ALB → 下游微服务（`vehicle-model-service`、`osm-gateway`、`backend-miker-offline` 等）。
- 域名：
  - dev：`api-dev.chekkk.com` → 命名空间 `dev`，Release `backend-gateway-saas`。
  - staging：`api-staging.chekkk.com`（预留）→ 命名空间 `staging`。
  - prod：`api.chekkk.com` → 命名空间 `miker-prod`。
- 职责：统一入口（路由/鉴权/限流），统一暴露健康检查与 OpenAPI，并注册到 Nacos。

二、标准工作流
- `ci.yml`（主 CI）
  - 触发：`push` 到 `main/dev/staging`，或手动 `workflow_dispatch`。
  - 行为：`mvn clean package` → 使用 Buildx 推镜像到 VECR（`dev/staging/prod/backend-gateway-saas:sha-<short>`）→ 可选按分支推 OpenAPI 到 YApi。
  - 运维要点：发布前确认对应 sha 镜像已存在于 VECR，否则容易出现 Pod `ImagePullBackOff`、Service 无 Endpoints。
- `deploy-dev.yml` / `deploy-staging.yml` / `deploy-prod.yml`
  - 触发：对应分支 push + 手动 `workflow_dispatch`。
  - 行为：使用 `kubectl + helm` 对 `dev/staging/miker-prod` 命名空间执行 `helm upgrade --install`，values 中将镜像 tag 固定为当前 `sha-<short>`。
  - 运维要点：若发布后 503/超时，先看目标命名空间中该 Release 的 Deployment Ready 状态与 Service Endpoints 是否为 0。
- `yapi-sync-build.yml`
  - 触发：`push` 到 `main/dev/staging` 或手动。
  - 行为：本地启动应用（禁用 Nacos/DB 自动配置），在 4010 端口导出 OpenAPI，然后调用 YApi 的 `api/open/import_data` 导入。
  - 运维要点：失败多为 `YAPI_BASE/YAPI_TOKEN_*` 未配置或 token 与 YApi 项目不匹配。
- `yapi-sync-incluster.yml`（仅运维）
  - 触发：手动 `workflow_dispatch`。
  - 行为：使用生产 kubeconfig 在 `platform-prod` 内创建临时 Job，从 `backend-gateway-saas.miker-prod.svc.cluster.local` 拉取 OpenAPI 并直接调用 `yapi.platform-prod` Service 导入。
  - 适用场景：希望 YApi 文档与线上网关的实际路由一键对齐时使用。

三、常见故障与排查
- ErrImagePull / 无 Endpoints
  - 现象：Deployment `backend-gateway-saas` Pod 状态 `ImagePullBackOff`，Service `backend-gateway-saas` `ENDPOINTS <none>`，通过网关访问任意路径均连接失败（curl 000）。
  - 排查：`kubectl -n <ns> describe pod backend-gateway-saas-...` 检查镜像 tag；在 VECR 中确认该 tag 是否存在；如刚合并 main，确认 `ci.yml` 已成功完成。
- 健康检查 403 / OpenAPI 503
  - 现象：`/api/vms/healthz`、`/api/osm-gateway/healthz` 或 `/api/offline/openapi.json` 通过网关访问返回 403/503。
  - 排查：确认 `SecurityConfiguration` 放行 `/actuator/**`、`/api/**/healthz`、`/**/openapi.json`；查看网关路由是否正确使用 `StripPrefix/SetPath` 指向下游 `/actuator/health` 或 `/openapi.json`。
- HTTP→HTTPS 行为异常
  - 现象：`http://api.chekkk.com` 返回 404 或直接命中业务服务。
  - 规范：同一域名的 80 Ingress 只允许一个“全域 301 重定向入口”，业务 Ingress 仅在 443 上暴露带前缀的业务路径（如 `/api/vms/**`、`/api/osm-gateway/**`）。
  - 排查：若发现多个命名空间声明同一 host+80，则以网关所在命名空间的 redirect Ingress 为准，其他服务只保留 443 规则。

四、Nacos 与配置
- 地址：通过 `SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR` 指向平台 Nacos（如 `172.31.120.5:8848`），各环境以命名空间隔离：`NACOS_NAMESPACE=miker-<env>`。
- 账号：显式注入 `SPRING_CLOUD_NACOS_DISCOVERY_USERNAME/PASSWORD`，生产环境禁止匿名。出现 403 `username and pwd is blank!` 时，先检查这两项是否正确配置。
- 健康与实例：遇到注册异常时，优先查看 Nacos 控制台中对应服务的实例列表与心跳状态，再对照网关 Pod 日志。

五、日常运维小结
- CI 视角：优先关注 `ci.yml` 与对应环境的 `deploy-*.yml`；YApi 相关工作流失败通常不会影响转发，但会导致文档不同步。
- 集群视角：发布异常时，按顺序检查 Deployment → Service Endpoints → Ingress；出现 `no endpoints available for backend-gateway-saas` 多为 Pod 未 Ready 或 selector 不匹配。
- 文档视角：YApi 项目名统一为 `backend-gateway-saas-<env>`；如接口或描述过旧，可通过 `yapi-sync-build.yml` 或 `yapi-sync-incluster.yml` 做一次全量刷新。

---

服务运维手册（vehicle-model-service｜Dev/Prod）

一、概览
- 技术栈：FastAPI，容器端口 `4010`。
- K8s：
  - Deployment：`vehicle-model-service`（dev / miker-prod）。
  - Service：`vehicle-model-service`，`port: 80 → targetPort: 4010`，供网关与内部直连使用。
- 网关路径：
  - 业务：`/api/vms/**` → StripPrefix=2 → 下游真实路径。
  - 健康检查：`/api/vms/healthz` → `/actuator/health`。
  - OpenAPI：`/api/vms/openapi.json` → `/openapi.json`。

二、CI/CD 与工作流
- `ci.yml`
  - 负责构建镜像并推送 VECR（`prod/dev` 仓库，标签 `sha-<short>` 等）。
- `deploy.yml`
  - 调用 `chekdata/ops-bootstrap/.github/workflows/deploy-helm-call.yml@main`，参数：
    - `service: vehicle-model-service`、`namespace: miker-prod`、
      `container_port: 4010`、`svc_port: 80`、`target_port: 4010`、
      `extra_values_file: helm/prod.values.yaml`。
  - 仅当改动命中 `.github/workflows/deploy.yml` 或 `helm/**` 时自动触发 prod 发布。
- `deploy-dev.yml`
  - 触发：`dev` / `dev/**` 分支的 `push` / `pull_request` / `workflow_dispatch`。
  - 步骤：写入 kubeconfig → 创建 `dev` 命名空间 → 确保镜像凭据 `vecr-auth` 和 TOS 凭据 `tos-creds` →
    渲染并 apply `k8s/dev/deployment.yaml` / `service.yaml` → `rollout status` →
    在 Pod 内跑一次 TOS 只读自检（`boto3.list_objects_v2`）。
- `openapi-generate.yml`
  - 安装 Python 依赖，设置 `PYTHONPATH=.` 后运行 `scripts/gen_openapi.py`，生成 `openapi.json` 并用 `create-pull-request` 创建更新 PR。
- `yapi-sync.yml`
  - job 级调用 `chekdata/.github/.github/workflows/yapi-sync-reusable.yml@main`：
    - `swagger-url=https://api.chekkk.com/api/vms/openapi.json`；
    - 根据分支选择 `YAPI_TOKEN / YAPI_TOKEN_STG / YAPI_TOKEN_DEV`；
    - 默认 `enable_llm: true`，通过组织级 `LLM_API_KEY` 开启 LLM 富化。

三、健康检查与排障
- 直连 Service：
  - `curl -sS -o /dev/null -w '%{http_code}\n' http://vehicle-model-service:80/healthz`
  - `curl -sS -o /dev/null -w '%{http_code}\n' http://vehicle-model-service:80/actuator/health`
  - `curl -sS -o /dev/null -w '%{http_code}\n' http://vehicle-model-service:80/api/vms/healthz`
- 通过网关：
  - `curl --max-time 10 -i https://api.chekkk.com/api/vms/healthz`
  - `curl --max-time 20 -i https://api.chekkk.com/api/vms/openapi.json`
- 常见问题：
  - 网关 503/404：多数是服务本身未暴露对应健康接口或 OpenAPI 路径。`vehicle-model-service` 已内置 `/healthz`、`/actuator/health`、`/api/vms/healthz`，后续新服务必须在代码层显式补齐。
  - YApi 同步失败：优先检查 `yapi-sync.yml` 是否 job 级 `uses` 复用组织工作流，以及仓库 Secrets 中 `YAPI_BASE/YAPI_TOKEN*` 是否配置正确。

---

服务运维手册（backend-miker-offline｜Prod）

一、概览
- 技术栈：FastAPI，容器端口（当前）`8088`。
- K8s：
  - Deployment / Service：`backend-miker-offline`（命名空间 `miker-prod`）。
- 网关路径：
  - 业务：`/api/offline/**`。
  - OpenAPI：`/api/offline/openapi.json` → `/openapi.json`（单一路由，绕过复杂过滤器）。

二、CI/CD 与工作流（目标形态）
- `ci.yml`
  - 构建 `backend-miker-offline` 镜像并推送 VECR。
- `deploy.yml`
  - 使用 `ops-bootstrap` 通用 Helm Chart，生成 Deployment/Service/Ingress，逐步替代手写 `k8s/prod/*.yaml`。
  - 由 ArgoCD Application 接管该 Chart；完成验证后，在 Argo 上标记 owner，并删除旧的手写清单。
- `openapi-generate.yml` + `yapi-sync.yml`
  - 通过脚本生成 `openapi.json`，上传为 artifact；
  - `yapi-sync.yml` 复用 `yapi-sync-reusable.yml` 的 artifact 模式，从 artifact 读取 OpenAPI 并导入 YApi，避免依赖外部访问 `api.chekkk.com`。

三、健康检查与 OpenAPI 排障
- 直连后端：
  - `kubectl -n miker-prod port-forward svc/backend-miker-offline 18080:80`
  - `curl -i http://127.0.0.1:18080/healthz`
  - `curl -i http://127.0.0.1:18080/openapi.json`
- 通过网关：
  - `curl --max-time 20 -i https://api.chekkk.com/api/offline/openapi.json`
- 常见问题：
  - 403/503：历史问题主要出在网关 ResponseBodyFilter 对大体积 OpenAPI JSON 的处理；现在通过专门路由和白名单绕过。后续新服务暴露 OpenAPI 时，统一使用 `/api/<svc>/openapi.json` + `SetPath=/openapi.json`，并在 `SECURE_IGNORE_URLS` 中放行。

服务运维手册（ALB / Ingress / 前端与 YApi 运行手册）

一、目标与范围
- 统一外部入口通过 ALB 承载，按环境（dev/staging/prod）独立实例、独立 IngressClass。
- 80 仅用作 HTTP→HTTPS 301，业务路径集中在 443。
- GitOps 为单一真源：Ingress/Service/证书/工作流全部入库，禁止控制台手工改规则（仅应急）。

二、常用路径与凭据位置
- Kubeconfig（只读/运维）：`tools/kube-conf/chek-<env>-k8s-public-kube.conf`
- GitOps 仓：`ops-bootstrap`（当前仓库）
- 预签名校验与清理脚本：`tmp/alb_verify_hosts.py`、`tmp/sg_scan.py`、`tmp/sg_delete_empty.py`

三、日常巡检（每日）
1) 预签名校验 ALB（80/443）：
   ```bash
   source tmp/venv/bin/activate
   export VOLC_AK=<RO_AK> VOLC_SK=<RO_SK> REGION=cn-beijing
   export ALB_PROD=<alb-prod-id> ALB_STAGING=<alb-stg-id> ALB_DEV=<alb-dev-id>
   export HOSTS=yapi.chekkk.com,app.chekkk.com,www.chekkk.com,app-staging.chekkk.com,www-staging.chekkk.com,app-dev.chekkk.com,www-dev.chekkk.com
   python tmp/alb_verify_hosts.py > /tmp/alb_verify.json
   ```
   - 期望：80 下无业务 ServerGroup（仅 redirect）；443 命中业务目标组且健康>0。
2) Ingress/Service 健康：
   ```bash
   KUBECONFIG=tools/kube-conf/chek-<env>-k8s-public-kube.conf \
     kubectl -n <ns> get ingress,svc,endpoints
   ```
   - 期望：Endpoints Ready 数量>0，Ingress 不处于 Deleting。

四、问题定位与修复
A. 80 返回 200 非 301
- 现象：HTTP 未经 ALB，或 80 存在业务规则。
- 排查：
  - DNS：确认域名为 CNAME → 对应环境 ALB 域名（不要 A 到 EIP）。
  - Ingress：80 侧 Ingress 仅有 `/ -> ssl-redirect:80`，注解包含 `ingress.vke.volcengine.com/actions.ssl-redirect` 与 `listen-ports: [{"HTTP":80}]`。
  - 预签名：确认 80 下无业务 ServerGroup。
- 修复：更新 Ingress（GitOps），合并后等待控制器收敛；必要时临时删除 80 下的业务规则（仅应急，随后回归 GitOps）。

B. 443 规则竞争/落入默认后端
- 现象：返回控制台默认页/404。
- 排查：是否缺少 `group.name/group.order` 或未显式 `listen-ports: [{"HTTPS":443}]`。
- 修复：在 443 的 Ingress 上补齐分组与优先级；单域尽量单 Ingress，确保 host-header 明确命中。

C. Admission 报错 “svc [...] has no port [0]”
- 原因：Ingress backend 使用 `port.name` 或 `use-annotation`。
- 修复：将后端端口改为数值 `number: 80`；`ssl-redirect` Service 使用 `port:80/targetPort:80`。

D. 503/502
- 现象：目标组无健康实例或后端拒绝。
- 排查：
  - Service selector → Endpoints；
  - Service `targetPort` 与容器端口一致；
  - 节点安全组是否放通 ALB 安全组到 NodePort 段；
  - 控制器日志是否提示 “no endpoints available”。
- 修复：修正 selector/端口，放通 SG；必要时重建 Ingress 以刷新目标组。

E. yapi 登录/302 到 `/feishu-sso/`
- 解释：应用内 SSO 插件行为（非 ALB）；`/user/login` 302 到 SSO 回调属预期。
- 健康检查：可用 `/user/login`（成功码 200,301,302）。
- 根路径：如监听 3000，使用 `yapi-web`（NodePort 80→3000）承载 `/`。

五、例行清理（每周）
1) 扫描空/不健康 ServerGroups（仅报告）：
   ```bash
   source tmp/venv/bin/activate
   export VE_REGION=cn-beijing VE_AK=<AK> VE_SK=<SK> ALB_PROD=<id>
   python tmp/sg_scan.py > /tmp/sg_candidates.json
   ```
2) 删除空目标组（谨慎，仅当未被规则引用）：
   ```bash
   export CANDIDATES_JSON="$(cat /tmp/sg_candidates.json)"
   python tmp/sg_delete_empty.py
   ```
3) 准则：被规则引用/健康>0 的目标组禁止删除；如需替换，先在 GitOps 中切换 Ingress/Service，待控制器生成替代组后再清理。

六、CI/CD 与 GitOps（前端）
- 应用仓工作流：构建并推 VECR → `repository_dispatch` 通知 GitOps 仓。
- GitOps 仓工作流：接收事件 → 运行 `tmp/update_manifests.py` 更新各环境镜像 → 创建带 `automerge` 标签的 PR → 自动合并 → Argo CD 同步。
- 必需 Secrets：
  - 应用仓：`VE_REGISTRY/VE_USERNAME/VE_PASSWORD/GITOPS_PAT`
  - GitOps 仓：`GITOPS_PAT`（用于创建/合并 PR）

七、DNS 规范（外部 DNS 如腾讯云）
- 建议使用 CNAME 指向 ALB 域名；TTL 60–300。
- 禁止 A 到 EIP（EIP 可能漂移；CNAME 更稳）。
- 分环境域名：`<svc>-dev|staging.chekkk.com`、生产 `app/www/yapi.chekkk.com`。

八、应急操作（尽量 24–48 小时内回归 GitOps）
- 临时在控制台删除 80 下的业务转发或修正 443 的 host 规则，以恢复服务；完成后立即将变更写回 Ingress，并清理手工规则。

九、附录：命令速查
```bash
# 应用最新 Ingress/Service（dev）
KUBECONFIG=tools/kube-conf/chek-dev-k8s-public-kube.conf \
kubectl apply -f frontend-app-dev -f frontend-saas-dev

# 预签名校验（prod/app/www/yapi）
source tmp/venv/bin/activate
export VOLC_AK=<RO_AK> VOLC_SK=<RO_SK> REGION=cn-beijing ALB_PROD=<alb-id>
export HOSTS=app.chekkk.com,www.chekkk.com,yapi.chekkk.com
python tmp/alb_verify_hosts.py | tee /tmp/alb_verify_prod.json
```

十、飞书通知与自动拉群（组织级复用）
- 入口工作流：组织仓 `.github/workflows/org-feishu-notify-sync.yml`
  - 触发：`repository_dispatch`（type: `feishu-ci-notify`）或手动 `workflow_dispatch`
  - Jobs：
    - `sync`：部门枚举 → `nickname == GitHub 登录名（小写）` 命中 → 以 `open_id` 将成员加入 `chat_id`
      - 产物：`feishu_diag.json`、`feishu_nicknames.json`、`feishu_sync_summary.json`
    - `notify`：调用 `reusable-feishu-ci-notify.yml` 发送卡片
- 仓库侧接入：在应用仓配置 `FEISHU_CHAT_ID_PROD`、`GITOPS_PAT`，并添加 `notify-dispatch.yml`（监听主 CI/CD 成功后派发）
- 常见故障：
  - 未入群但成功：多为 `chat_id` 为空 → 检查应用仓 `FEISHU_CHAT_ID_PROD`
  - 命中人数少：成员飞书昵称与 GitHub 登录名不一致 → 统一昵称为登录名（小写）
  - 未收到通知：确认组织级存在 `notify` 作业，且应用仓已派发到 `.github`

十一、GitHub 清理 SOP（保守）
- 工作流（Workflows）
  - 保留：主发布（如 `cd-on-merge`）、组织派发（`notify-dispatch`）、飞书通知（`feishu-notify`）
  - 候选禁用：90–120 天无运行或已被替换的工作流；先“禁用”观察，再考虑删除 YAML
- 分支（Branches）
  - 保留：`main/master`、`develop`、`dev/staging` 等主分支
  - 候选删除：前缀 `fix-/feat-/ci-/deploy-/temp-/test-/hotfix-/chore-/revert-`，且
    - 非开放 PR 的 head；且最近提交超过 7–14 天；且已不在发布计划
  - 删除顺序：先在仓库“分支保护”放开限制 → 删除 → 恢复保护
- PR（Pull Requests）
  - 仅关闭部署脚手架/临时性 PR 且无后续计划的；保留功能/修复类
  - 关闭前在描述中补上原因与链接，便于审计

十二、VECR 镜像清理 SOP（前置条件）
- 当前镜像“免密拉取”不等于“匿名可列举/删除”，列举/删除需具备权限：
  - 任选其一：机器人账号 token（含 delete）/ OpenAPI AKSK（镜像仓库读删）/ 开启匿名列表权限
- 清理策略（具备权限后）：
  - 标签匹配：`tmp|temp|test|ci|pr|dev|staging` 等临时/环境标签
  - 过期策略：非活跃 > 30/60 天；同一基线仅保留最近 N 个版本
  - 执行方式：先生成计划（dry-run 报表）→ 人工确认 → 批量删除
- 审计与回溯：输出“仓库/标签/创建时间/最后拉取时间/删除人/时间”到报表归档

十三、DNS 运维规范
- 权威 DNS：放在“腾讯云”，火山引擎侧不再新建 A 记录
- 外部解析：一律 CNAME 到 ALB 域名；TTL 建议 300（60–300 视情况）
- 变更窗口：在低峰变更；变更后执行外网与集群内双路径验证

十四、夜间校验与每周清理（作业落地）
- Nightly 验证（组织级）
  - 校验监听器 80/443、规则 host-header 命中、ServerGroup 健康
  - 产物作为告警输入；失败需创建问题单并在 24h 内处理
- Weekly 清理
  - 空/不健康 ServerGroup 定位与清理（遵循“未被规则引用/无健康实例”原则）
  - 配合 GitOps 变更：先切流再删组，避免流量中断

